1
00:00:22,089 --> 00:00:26,560
调试能量的问题


2
00:00:28,462 --> 00:00:29,396
你们好


3
00:00:31,532 --> 00:00:32,399
嗨
大家好


4
00:00:32,933 --> 00:00:33,767
早上好


5
00:00:34,401 --> 00:00:36,703
希望你们在苹果全球开发者大会上愉快


6
00:00:37,871 --> 00:00:39,006
我叫Abhinav Pathak


7
00:00:39,072 --> 00:00:40,941
和我的同事
Pai-Han Huang


8
00:00:41,008 --> 00:00:43,110
将要谈谈调试能量的问题


9
00:00:44,211 --> 00:00:46,547
我们将向你们显示我们现有的工具


10
00:00:47,181 --> 00:00:50,951
以及我们今年特意
为iOS构建的新的工具


11
00:00:51,552 --> 00:00:56,223
使用这些工具
你发现你的应用程序中的能量问题


12
00:00:56,390 --> 00:00:59,159
另一方面就是了解决这些问题
客户就会真正喜欢你的程序


13
00:01:00,928 --> 00:01:01,762
让我们开始


14
00:01:03,163 --> 00:01:04,230
红色的电池图标


15
00:01:04,331 --> 00:01:07,267
当它出现的时候我们都很憎恨它


16
00:01:08,468 --> 00:01:09,837
客户也很憎恨它


17
00:01:11,271 --> 00:01:17,411
具有良好的电池寿命对于
精彩的用户体验是十分重要的


18
00:01:18,579 --> 00:01:24,985
一次又一次证明
人们所想要的最重要特色是电池的寿命


19
00:01:26,420 --> 00:01:28,622
在Apple
为确保客户获得良好的电池寿命


20
00:01:28,922 --> 00:01:32,059
我们做出了很大的努力


21
00:01:32,926 --> 00:01:38,932
然而通常客户运行的应用程序


22
00:01:38,999 --> 00:01:41,935
是从它们的设备中吸走能量的主要原因


23
00:01:43,470 --> 00:01:44,905
为了帮助我们的客户了解


24
00:01:45,372 --> 00:01:49,443
哪个程序消耗电池能量
哪个程序耗能最大


25
00:01:49,776 --> 00:01:56,016
几年前针对OS X侧
我们就有了活动监测能量影响工具


26
00:01:56,517 --> 00:01:57,417
在这里你可以看到


27
00:01:57,484 --> 00:02:03,657
每个应用程序瞬间及一段时间内的影响


28
00:02:03,724 --> 00:02:06,693
这样用户就可以了解
他们的设备发生了什么


29
00:02:07,995 --> 00:02:12,165
在iSO 8
我们引入了电池使用用户界面


30
00:02:12,232 --> 00:02:13,634
一个面向用户的UI


31
00:02:14,234 --> 00:02:18,372
在这里他们可以看到
最后24小时以及最后7天内


32
00:02:18,805 --> 00:02:23,644
能量在他们所
使用的不同的应用程序中的分解比例


33
00:02:25,579 --> 00:02:28,815
排在前面的应用程序可能有正当的理由


34
00:02:28,882 --> 00:02:31,785
“嗨 我喜欢这个应用程序
所以我一直在用”


35
00:02:32,986 --> 00:02:35,889
为了使客户更好地了解
这里的关键因素是什么


36
00:02:36,490 --> 00:02:41,161
今年我们在它的顶部包括了一个
单独触发器


37
00:02:41,228 --> 00:02:44,531
在这里他们可以切换
并且看到使用了多少应用程序


38
00:02:45,065 --> 00:02:47,167
获得多少屏幕时间


39
00:02:47,367 --> 00:02:49,169
以及它在后台运行使用了多少


40
00:02:49,570 --> 00:02:52,172
然后他们就可以进行评估
“嗨 我用它用的多”


41
00:02:52,306 --> 00:02:54,374
或者“嗨 这个程序消耗了很多能量”


42
00:02:56,543 --> 00:03:02,649
这个讲座就是关于
如果你的应用程序在列表中名列前茅


43
00:03:03,150 --> 00:03:07,855
你怎样把它降下来
同时不影响用户的使用的问题


44
00:03:08,655 --> 00:03:11,191
这个讲座也针对通常耗能很少的人们


45
00:03:11,258 --> 00:03:15,095
如何才能耗能更少
并且获得完美的客户体验


46
00:03:16,730 --> 00:03:19,366
为了更好地进行概括


47
00:03:19,600 --> 00:03:21,635
我们将快速介绍
能量的基本原理和最佳范例


48
00:03:21,702 --> 00:03:24,271
我们将对早晨的讲座进行总结


49
00:03:25,339 --> 00:03:27,841
我们将向你展示能量调试流程


50
00:03:28,041 --> 00:03:31,245
以及我们用来调试能量的工具


51
00:03:32,212 --> 00:03:33,413
我们将进行演示


52
00:03:33,680 --> 00:03:39,386
我们为这次讲座
专门构建的样本程序中修复能量问题


53
00:03:39,586 --> 00:03:45,726
向你展示修复能源问题是多么简单
然后我们就将结束这次讲座


54
00:03:49,463 --> 00:03:50,297
就这么简单


55
00:03:50,364 --> 00:03:52,533
每个人都知道
能量101


56
00:03:52,799 --> 00:03:54,601
能量等于功率乘以时间


57
00:03:55,269 --> 00:03:56,670
我们现在看到这里有个图表


58
00:03:57,070 --> 00:03:59,106
X轴是时间
Y轴是功率


59
00:03:59,173 --> 00:04:01,308
这是一个应用程序使用波形图


60
00:04:01,608 --> 00:04:02,442
发生了什么


61
00:04:02,509 --> 00:04:06,313
我们说一个用户启动一个应用程序
一堆活动在后台支持这个程序


62
00:04:06,547 --> 00:04:07,648
然后该程序就悬停


63
00:04:08,782 --> 00:04:10,517
最重要的一点是


64
00:04:10,584 --> 00:04:15,923
图表下面的整个区域
都是这个特定的应用程序的能量消耗


65
00:04:18,325 --> 00:04:20,394
能量是由功率和时间来决定的


66
00:04:20,861 --> 00:04:22,362
为了进一步说明这一点


67
00:04:22,663 --> 00:04:25,332
我们在这里取两个长方形


68
00:04:25,666 --> 00:04:30,003
它们消耗的功率是不同的
消耗的时间也是不同的


69
00:04:30,237 --> 00:04:31,772
但是他们的能量消耗是相同的


70
00:04:34,608 --> 00:04:35,509
第二个概念


71
00:04:37,911 --> 00:04:40,480
有些叫做固定成本的东西
有些东西叫做动态成本


72
00:04:40,814 --> 00:04:44,251
我们在系统中的许多的硬件组件


73
00:04:44,518 --> 00:04:47,654
如果你要使用它们
我们必须将它们引入一种


74
00:04:47,721 --> 00:04:49,523
它们可以开始服务于你的请求的状态


75
00:04:50,490 --> 00:04:55,329
相比休眠转态
这些状态消耗能量很大


76
00:04:55,829 --> 00:04:58,966
一旦将它们引入
它们就做你要求它做的工作


77
00:04:59,433 --> 00:05:02,603
然后我们让它们保持等待状态


78
00:05:02,870 --> 00:05:04,304
你知道的
将会有更多的工作出现


79
00:05:04,605 --> 00:05:06,273
一旦我们看到没有出现工作出现


80
00:05:06,440 --> 00:05:09,176
我们让它们平静下来
进入睡眠


81
00:05:10,944 --> 00:05:14,014
固定成本可以是非常非常昂贵


82
00:05:14,448 --> 00:05:17,451
我们在整个的讲座中
都将追踪这个固定成本


83
00:05:17,518 --> 00:05:20,220
只要它开始影响你的应用程序


84
00:05:22,322 --> 00:05:28,195
当说到降低能量的使用方法
有三条非常简单的你需要遵守的规则


85
00:05:28,795 --> 00:05:30,764
第一个规则
永远不要做


86
00:05:31,798 --> 00:05:34,835
客户真的需要完成那个工作吗？


87
00:05:35,469 --> 00:05:38,105
如果你不做它
固定成本 动态成本 能量功率时间


88
00:05:38,205 --> 00:05:40,307
我们说到的所有的一切东西都是零


89
00:05:41,141 --> 00:05:41,975
真了不起


90
00:05:43,710 --> 00:05:45,412
如果你必须做
就少做点


91
00:05:45,812 --> 00:05:50,083
用最少的工作量来满足客户的需要


92
00:05:51,885 --> 00:05:53,420
下一个就是
在一个更好的时间去做


93
00:05:54,021 --> 00:05:57,291
一个客户在野外拍摄照片


94
00:05:57,357 --> 00:05:59,259
我难道需要现在
就把照片上传到服务器上面


95
00:05:59,660 --> 00:06:03,363
也许应该有些耐心
等到用户将电源插头接上再说


96
00:06:05,566 --> 00:06:07,100
第三点就是要高效地去做


97
00:06:07,167 --> 00:06:12,272
什么是最有效的算法
或者我用最好的办法来服务这个请求


98
00:06:12,773 --> 00:06:17,511
我们可以看到这些不断地
在我们讲座的不同部分中出现


99
00:06:20,781 --> 00:06:24,184
这些问题需要插入我们所具有的
能量调试流程和工具才能解决


100
00:06:24,918 --> 00:06:27,955
让我们来看看能量调试流程是什么样子


101
00:06:28,155 --> 00:06:30,457
它与正常的软件工程调试很相似


102
00:06:30,891 --> 00:06:33,060
你都做些什么
你编写代码并构建它


103
00:06:34,161 --> 00:06:35,996
你在一个非常简单的调试器上运行代码


104
00:06:36,063 --> 00:06:39,366
该调试器将向你
显示你的代码中的高级别问题是什么


105
00:06:39,833 --> 00:06:43,537
你可以很容易地识别 修复很多问题
然后你再重新运行它


106
00:06:44,972 --> 00:06:46,640
然而有些问题很难


107
00:06:47,040 --> 00:06:50,978
你不断进行修改并说，
“给我一个集中调试器，好吗？”


108
00:06:51,111 --> 00:06:52,179
“嗨 我有内存问题”


109
00:06:52,246 --> 00:06:54,448
让我获得一个针对内存的集中工具


110
00:06:54,515 --> 00:06:58,752
可以直接针对我的程序代码的确切行
问题在哪？


111
00:06:59,920 --> 00:07:01,121
一旦你用这个完成了调试


112
00:07:01,455 --> 00:07:03,524
你将它发给你的客户
你的客户就可以使用了


113
00:07:05,425 --> 00:07:10,364
在OSX一侧有Xcode
在这里你可以编写和构建你的程序


114
00:07:12,232 --> 00:07:16,170
作为通用调试器的一部分
在Xcode的内部有能量调试工具


115
00:07:16,236 --> 00:07:17,671
我们马上就要谈到这种调试工具


116
00:07:18,105 --> 00:07:21,608
这些说明最主要的是
告诉你的应用程序是如何运转的


117
00:07:23,544 --> 00:07:26,346
作为仪器的一部分
我们有集中工具


118
00:07:26,413 --> 00:07:27,381
一旦你识别


119
00:07:27,447 --> 00:07:31,218
你会说“嗨 系统的这部分有问题
让我过来修复这个问题”


120
00:07:31,985 --> 00:07:34,555
至于客户会受到能量消耗的影响


121
00:07:34,855 --> 00:07:36,056
他们可以过来看看


122
00:07:37,791 --> 00:07:39,092
在我们进入到工具之前


123
00:07:39,560 --> 00:07:42,362
让我们来看看
在OSX上的能量调试优先级


124
00:07:42,930 --> 00:07:46,266
原因就是该工具非常关注
能量调试优先级


125
00:07:46,333 --> 00:07:50,504
因为它们能向你指出
你需要修复你的问题的确切位置


126
00:07:52,139 --> 00:07:58,512
OSX上的优先级是CPU和GPU


127
00:07:59,546 --> 00:08:02,049
它们有很高的固定成本


128
00:08:03,083 --> 00:08:07,054
要将它转入它们可以为你服务
或者你的请求在空闲转态


129
00:08:07,754 --> 00:08:13,227
消耗的功率是它们在休眠状态下的十倍


130
00:08:14,528 --> 00:08:15,662
一旦它们在空闲状态


131
00:08:15,729 --> 00:08:17,364
如果你使用了百分之一的CPU


132
00:08:17,631 --> 00:08:20,968
那就是要比最高空闲功率
消耗多百分之十


133
00:08:21,602 --> 00:08:23,136
从那时起 指数增加


134
00:08:23,403 --> 00:08:27,508
百分之十的CPU 2倍的空闲状态
百分之百的CPU 一百倍的空闲状态


135
00:08:28,942 --> 00:08:30,177
这里的规则很简单


136
00:08:30,310 --> 00:08:33,179
如果你不需要 就不要惊醒CPU


137
00:08:33,413 --> 00:08:34,948
让这头大熊睡去吧 不要去挑拨它


138
00:08:37,717 --> 00:08:40,953
我们在Xcode中的工具
我管它叫能量计量器


139
00:08:42,121 --> 00:08:44,725
它打印出你的能量报告
就像是这个样子


140
00:08:44,892 --> 00:08:45,726
你如何到达那儿


141
00:08:46,093 --> 00:08:50,063
你如果在运行你的应用程序
你点击调试分析部分


142
00:08:50,497 --> 00:08:52,399
你一点击那儿
你就会看到一群计量器


143
00:08:52,833 --> 00:08:54,334
点击能量影响计量器


144
00:08:54,968 --> 00:08:55,869
你就会看到那个报告


145
00:08:56,670 --> 00:08:57,704
你在报告中看到什么


146
00:09:00,574 --> 00:09:06,446
最主要的是
你会看到你是否是OSX中的坏公民


147
00:09:07,014 --> 00:09:11,084
最根本的是
是否你正在使用超高CPU


148
00:09:11,952 --> 00:09:14,121
如果你在阻止


149
00:09:14,454 --> 00:09:18,125
你的应用程序在后台中
且用户看不到它


150
00:09:18,792 --> 00:09:22,196
系统会尝试让你进入App Nap中
这是一种后台悬置状态


151
00:09:22,563 --> 00:09:24,264
而你正在阻止系统那样做


152
00:09:24,665 --> 00:09:26,233
你并没有积极服务于任何请求


153
00:09:26,500 --> 00:09:27,734
但是你消耗了很多的能量


154
00:09:28,836 --> 00:09:31,672
空闲阻止
你不让CPU进入空闲状态


155
00:09:31,939 --> 00:09:34,408
如果它不能进入空闲状态
它就不能进行休眠状态


156
00:09:35,008 --> 00:09:38,679
一旦进入休眠状态
CPU唤醒开销就会说


157
00:09:38,846 --> 00:09:42,082
“嗨 负责把这个家伙唤醒”


158
00:09:43,750 --> 00:09:46,954
你一旦找出了最可能发生问题的地方


159
00:09:47,254 --> 00:09:50,357
你能做的就只能在报告的下面


160
00:09:50,424 --> 00:09:53,227
你有我们刚才所描述的事情


161
00:09:53,694 --> 00:09:56,964
但是你有这些可以跳入工具的按钮


162
00:09:57,431 --> 00:10:00,767
这些工具专门为每个区域使用的


163
00:10:01,268 --> 00:10:07,074
你知道的它们能够帮助你定位
哪行代码正在导致很高的CPU的使用


164
00:10:07,474 --> 00:10:09,810
哪行代码正在导致唤醒开销


165
00:10:10,444 --> 00:10:12,779
你可以继续调试你的程序


166
00:10:14,882 --> 00:10:17,718
说到减少OSX上的能量


167
00:10:18,318 --> 00:10:20,954
我们再次强调我们的三个简单的规则
永远不要做 做得少一些


168
00:10:21,822 --> 00:10:23,223
你想要合并所有的计时器


169
00:10:23,390 --> 00:10:25,325
你不想不断地唤醒系统


170
00:10:26,226 --> 00:10:27,261
最小化CPU唤醒


171
00:10:28,295 --> 00:10:29,496
在最佳时间唤醒


172
00:10:29,696 --> 00:10:33,100
使用后台活动调度程序API


173
00:10:33,166 --> 00:10:35,002
在这个调度程序
你可以指定许多的参数


174
00:10:35,302 --> 00:10:37,204
并且可以让系统来替你选择最佳的时间


175
00:10:38,438 --> 00:10:39,373
有效地去做


176
00:10:39,706 --> 00:10:43,744
在工作队列中设置最佳的工作优先级
QoS工作优先级


177
00:10:44,511 --> 00:10:45,646
编写一个计算程序算法


178
00:10:49,216 --> 00:10:50,517
我们接着说iOS


179
00:10:51,318 --> 00:10:55,088
CPU仍然是主要的能量消耗


180
00:10:56,223 --> 00:10:59,993
但是由于这些设备
与OSX中的设备是不同的


181
00:11:00,227 --> 00:11:05,933
其它的几样东西也在起作用


182
00:11:06,600 --> 00:11:10,370
首先是两个外围
定位和连网


183
00:11:10,504 --> 00:11:14,508
它们与CPU一样
在一些情况下很费能量


184
00:11:16,210 --> 00:11:19,680
接下来
当一个应用程序在后台中运行时


185
00:11:19,746 --> 00:11:23,116
你的程序会消耗所有这三个硬件


186
00:11:23,317 --> 00:11:25,118
它会消耗许多的能量


187
00:11:25,485 --> 00:11:31,058
你并没有显示能量
但是所有其它的组件消耗能量都很巨大


188
00:11:31,925 --> 00:11:34,194
让我们来一个个看一下


189
00:11:35,996 --> 00:11:38,398
定位能量通常是这样起作用的


190
00:11:38,532 --> 00:11:40,000
它的功率并不很高


191
00:11:40,167 --> 00:11:45,005
功率被你已经调用的API
及你所调用程序的精确度的数据所消耗


192
00:11:46,073 --> 00:11:49,643
时间组件很大
那就导致了能量变得巨大


193
00:11:51,545 --> 00:11:55,482
说到修复定位
同样的原则 从来不做


194
00:11:56,116 --> 00:11:59,119
只有你真的需要它时
只做连续定位


195
00:11:59,186 --> 00:12:01,088
用户就会真的请求它


196
00:12:01,421 --> 00:12:03,824
请在完成时就立即停止


197
00:12:03,891 --> 00:12:07,194
一旦你获得了定位
一旦你的请求获得满足 就停止


198
00:12:08,996 --> 00:12:10,597
下面是是高效地去做


199
00:12:10,664 --> 00:12:12,199
你需要的最精确是什么


200
00:12:12,266 --> 00:12:15,636
你需要知道三英尺之内的
用户在地球的位置吗？


201
00:12:16,036 --> 00:12:18,772
或者为晴空万里城市预测气候吗？


202
00:12:20,240 --> 00:12:21,408
你到底想要做些什么


203
00:12:21,842 --> 00:12:24,244
我们进入到定位网站


204
00:12:24,311 --> 00:12:28,549
我们说“嗨
这里有一批人们想要使用范例”


205
00:12:28,949 --> 00:12:35,923
每个使用范例我们都设计了API
目的是更好地服务于开发者你


206
00:12:36,757 --> 00:12:40,527
试着读一下这些API
什么是你真正想要的


207
00:12:40,594 --> 00:12:44,698
我们将为你做好能源管理工作


208
00:12:47,434 --> 00:12:49,403
说到连网


209
00:12:50,437 --> 00:12:52,739
类似的原则
从来不做 消减传输


210
00:12:53,340 --> 00:12:55,175
你能缓存吗？
你能压缩吗？


211
00:12:55,609 --> 00:12:58,512
你需要在最小的组成要素上
最高质量的媒体吗？


212
00:13:01,748 --> 00:13:03,951
你能在更好的时间去做吗？
你考虑过容忍吗？


213
00:13:04,184 --> 00:13:05,052
什么时候需要它？


214
00:13:05,586 --> 00:13:07,621
你能将它标为任意吗？


215
00:13:08,188 --> 00:13:10,591
你将它标为任意的时刻
就是系统接管的时刻


216
00:13:10,924 --> 00:13:13,994
你可以规定
在接下来的6小时或12个小时内


217
00:13:14,127 --> 00:13:16,363
我需要将这个上载或下载


218
00:13:16,730 --> 00:13:20,367
系统就会计算出什么是
最佳的时间来为你做这个工作


219
00:13:20,434 --> 00:13:22,870
一旦工作完成 系统就会告诉你
嗨 工作干完了


220
00:13:25,105 --> 00:13:26,740
做的更加有效些


221
00:13:27,174 --> 00:13:28,642
合并传输


222
00:13:29,076 --> 00:13:31,879
让我们来看个例子
这个是什么意思


223
00:13:32,412 --> 00:13:36,717
我们说你有个同步数据到服务器的请求
用户在使用你的应用程序


224
00:13:36,783 --> 00:13:40,654
因为数据在设备上产生
用户只能周期性地同步


225
00:13:41,722 --> 00:13:42,656
很简单的解决方案


226
00:13:43,557 --> 00:13:47,361
当数据正在设备上产生的时候
只需要不断地推送它


227
00:13:48,629 --> 00:13:49,596
这会发生什么


228
00:13:50,030 --> 00:13:51,999
每推送一次
你提供了数据


229
00:13:52,533 --> 00:13:56,537
你发送你的10比特 100比特
射频停留了很长的时间


230
00:13:56,603 --> 00:13:57,504
然后它睡着了


231
00:13:58,005 --> 00:13:59,506
下一次推送
相同的现象在重复


232
00:14:01,175 --> 00:14:04,044
固定成本在那个阶段是很高的


233
00:14:05,145 --> 00:14:05,979
你如何来修复它呢


234
00:14:06,580 --> 00:14:07,414
非常简单


235
00:14:07,681 --> 00:14:08,882
合并所有的传输


236
00:14:09,283 --> 00:14:11,718
让用户与该设备进行互动构建一个状态


237
00:14:12,052 --> 00:14:14,655
然后偶尔将状态发送到云上


238
00:14:15,222 --> 00:14:18,892
这样你就只支付了一次固定价格的费用


239
00:14:25,165 --> 00:14:26,066
下来讨论后台


240
00:14:26,700 --> 00:14:29,736
首先 当你的应用程序在后台运行时


241
00:14:29,837 --> 00:14:31,939
它耗尽了用户的能量


242
00:14:32,973 --> 00:14:35,909
如果没有必要
不要在后台中做任何事情


243
00:14:37,411 --> 00:14:41,715
如果你需要去做它
尽快调用你的任务完成处理器


244
00:14:43,283 --> 00:14:48,255
这个任务完成处理器是在向系统表示说
“嗨 我完成了


245
00:14:48,722 --> 00:14:50,824
请悬置我吧
请让设备睡觉吧”


246
00:14:52,726 --> 00:14:53,560
做得更有效率些


247
00:14:53,760 --> 00:14:57,965
正如你所知
有许多的后台API可以帮系统忙


248
00:14:58,198 --> 00:15:02,002
在你发现的最佳时间
最佳的能量消耗周期


249
00:15:02,970 --> 00:15:06,306
请替我做这个工作
系统就会替你去做


250
00:15:08,909 --> 00:15:11,378
让我们回到iOS上的能量调试流程


251
00:15:11,879 --> 00:15:14,982
我们目前只有Xcode
在这里你编写和构建你的代码


252
00:15:16,250 --> 00:15:20,487
客户拥有电池使用用户UI
他们可以看到程序是如何节约能量的


253
00:15:23,023 --> 00:15:26,059
到目前为止
我们有开发的工具


254
00:15:26,493 --> 00:15:28,962
叫做能量诊断工具


255
00:15:29,029 --> 00:15:32,132
它可以对你的程序的行为做初步诊断


256
00:15:32,733 --> 00:15:33,867
让我们来看看这个工具


257
00:15:35,035 --> 00:15:35,936
你怎样才能使能它呢


258
00:15:36,303 --> 00:15:39,840
你进入到设置
开发者来到记录窗口


259
00:15:40,707 --> 00:15:43,544
你打开这里的能量触发器


260
00:15:43,677 --> 00:15:45,412
然后你就说
“嗨 开始记录”


261
00:15:47,414 --> 00:15:48,549
一旦你开始记录


262
00:15:48,882 --> 00:15:51,151
就像你的用户那样
使用你的应用程序


263
00:15:51,552 --> 00:15:56,089
持续上几个小时
12个小时 24个小时 几天


264
00:15:56,623 --> 00:15:59,259
一旦你完成了
只要点击按钮 结束记录


265
00:16:03,397 --> 00:16:08,035
下面将你的设备与Mac连接
进入工具 选择能量诊断


266
00:16:08,101 --> 00:16:10,671
然后说“嗨 导入你刚才的记录数据”


267
00:16:11,438 --> 00:16:14,808
你一旦那样做
你就获得像这样的图片


268
00:16:16,476 --> 00:16:22,850
这里试图想向你说明当你在使用时


269
00:16:23,116 --> 00:16:25,385
那些占用大量性能硬件的状态


270
00:16:25,752 --> 00:16:29,256
你会看到GPU的状态
你会看到Wi-Fi 蓝牙


271
00:16:29,423 --> 00:16:33,427
你会看到它们呆了多长时间
什么时候在上面 什么时候离开等等


272
00:16:33,827 --> 00:16:36,196
你将会看到有多少数据包
从每个接口中发出


273
00:16:36,263 --> 00:16:37,598
CPU的活动性是什么


274
00:16:38,098 --> 00:16:42,102
在顶部 你将会看到能量使用等级
是20中的多少量


275
00:16:42,169 --> 00:16:44,505
如果你是20中的20
相信我 你有麻烦了


276
00:16:45,072 --> 00:16:47,174
这是非常非常高的能量消耗


277
00:16:47,474 --> 00:16:49,076
你希望靠近1


278
00:16:51,044 --> 00:16:54,081
如果你想要做长期的实验
这个工具是很不错的


279
00:16:54,681 --> 00:16:58,952
但是它不能做的是它不能告诉你
为什么硬件能量在上升


280
00:16:59,253 --> 00:17:01,622
你请求它了吗？
你在哪儿请求它了？


281
00:17:02,055 --> 00:17:05,125
它并没有精确定位
没有细致到进入你的代码


282
00:17:07,194 --> 00:17:08,095
为解决这个问题


283
00:17:08,694 --> 00:17:10,797
今年我们引入了


284
00:17:12,232 --> 00:17:18,070
在iOS上
的能量计量器以及一些工具


285
00:17:18,438 --> 00:17:22,542
这可以用来精确定位产生问题的代码


286
00:17:24,578 --> 00:17:27,181
为了进行详细说明
让我们来进行演示


287
00:17:27,580 --> 00:17:32,286
我的同事Pai-Han Huang
将来谈谈这个


288
00:17:37,191 --> 00:17:42,262
好 在这个演示中
我将谈谈这个能量故障工具的主要特点


289
00:17:43,430 --> 00:17:44,264
演示应用程序


290
00:17:44,498 --> 00:17:50,337
向你展示如何使用这个新工具来识别
和提高你的应用程序的能量效率


291
00:17:51,405 --> 00:17:52,306
作为一名开发者


292
00:17:52,906 --> 00:17:56,710
我喜欢这些新的工具
因为它们易于使用 有效


293
00:17:57,377 --> 00:17:58,412
因此在演示结束后


294
00:17:58,512 --> 00:18:03,250
我希望你们和我一样
将这些新的工具用到项目设计中


295
00:18:04,618 --> 00:18:06,987
演示主要有两部分组成


296
00:18:07,454 --> 00:18:11,658
一个是新工具箱
另外一个是演示应用程序


297
00:18:12,159 --> 00:18:15,429
首先让我来向你们介绍新的工具箱


298
00:18:21,435 --> 00:18:25,372
我们看到的是
iOS能量计量器的屏幕截图


299
00:18:25,439 --> 00:18:31,011
是其它新能量调试工具的入口点


300
00:18:33,013 --> 00:18:34,681
它在哪儿呢？


301
00:18:35,549 --> 00:18:39,386
它实际上
在Xcode调试导航器的内部


302
00:18:39,953 --> 00:18:41,588
你可以在这儿看见


303
00:18:42,923 --> 00:18:44,858
在你通过Xcode
启动了你的应用程序后


304
00:18:45,325 --> 00:18:49,062
你就会自动地进入到这里


305
00:18:50,097 --> 00:18:53,734
当你点击它的时候
它就会将你带到屏幕的右手侧


306
00:18:55,903 --> 00:19:01,909
能量计量器能将代码的能量影响可视化


307
00:19:02,342 --> 00:19:05,612
瞬间的和实例的平均的
能量影响也可以实现


308
00:19:06,713 --> 00:19:13,353
因此首先是你的代码瞬间的能量影响
可以在那里的场计量器中看到


309
00:19:17,691 --> 00:19:21,128
在这个图表中有三个不同的区域


310
00:19:21,795 --> 00:19:24,631
在里程表中 最下面的一个
当指针指向一个绿色区域


311
00:19:25,065 --> 00:19:28,035
它表明你的代码的能量影响
实际上是合理的


312
00:19:28,869 --> 00:19:32,272
祝贺你
你是iOS生态系统的好公民


313
00:19:33,140 --> 00:19:34,408
但是我仍然要建议你


314
00:19:34,641 --> 00:19:39,079
去看看这些新的工具
看看你如何能使你的客户更加快乐


315
00:19:40,280 --> 00:19:43,317
当指针向上移动时
它就进入了黄色区域


316
00:19:44,451 --> 00:19:47,521
在黄色区域中
你的代码的能量影响是很大的


317
00:19:48,255 --> 00:19:51,058
很有可能你没有仔细对待它


318
00:19:51,892 --> 00:19:55,729
在电池使用用户界面中
你的应用程序会显示很高能量消耗


319
00:19:56,430 --> 00:20:02,402
因此请使用新的能量调试工具来
看看如何提高你的代码的能量效率


320
00:20:03,403 --> 00:20:07,574
但是如果指针在继续向上移动
你进入了红色区域


321
00:20:08,308 --> 00:20:13,080
红色区域表示
代码的能量影响是很大的


322
00:20:13,947 --> 00:20:17,017
它意味着只要稍微使用你的应用程序


323
00:20:17,985 --> 00:20:22,155
用户会很明显地感到
设备上的电池有明显地下降


324
00:20:22,756 --> 00:20:25,259
所以请使用新的工具


325
00:20:25,592 --> 00:20:26,493
请使用新的工具！


326
00:20:28,061 --> 00:20:32,299
对不起 我表示道歉
我那样不太好 我总是抗议


327
00:20:32,766 --> 00:20:34,735
那些不认真对待电池寿命的人


328
00:20:35,502 --> 00:20:37,671
我向你承诺 我是个非常不错的人


329
00:20:37,738 --> 00:20:40,407
请来今天下午的最后一个讲座
我们来谈谈


330
00:20:41,275 --> 00:20:42,109
好么？


331
00:20:45,379 --> 00:20:48,482
但是速度计能向你提供


332
00:20:48,549 --> 00:20:52,886
应用程序的瞬间能量影响的整个信息


333
00:20:53,620 --> 00:20:55,122
如果你想看到更多的分解信息


334
00:20:56,890 --> 00:20:59,459
你应该看这儿


335
00:21:00,460 --> 00:21:01,395
能量影响分段


336
00:21:02,396 --> 00:21:05,666
这个图表每秒钟就要刷新一次


337
00:21:06,867 --> 00:21:10,370
如果你的应用程序给CPU


338
00:21:10,871 --> 00:21:12,940
定位或连网引入了任何的工作负载


339
00:21:13,407 --> 00:21:19,346
你就会看到一个方块
显示在对应的时隙中的顶部的三行中


340
00:21:20,581 --> 00:21:22,616
正如前面的讲座中所提到的


341
00:21:23,150 --> 00:21:26,653
你的应用程序不只是
在前台能够消耗掉大量的功率


342
00:21:26,920 --> 00:21:28,255
在后台也一样


343
00:21:28,956 --> 00:21:32,092
因此基于此次观察
我们有了第四条有关后台规则


344
00:21:33,026 --> 00:21:36,330
当你的应用程序呆在后台不离开


345
00:21:37,064 --> 00:21:40,334
你就会看到移动的方块显示在第四行上


346
00:21:41,368 --> 00:21:44,204
在这个图表的上面
你就会看到一系列的彩色条


347
00:21:46,607 --> 00:21:47,975
它们就像是这个


348
00:21:49,142 --> 00:21:49,977
有两种颜色


349
00:21:50,777 --> 00:21:53,947
红色表示开销


350
00:21:54,481 --> 00:22:00,521
用提供的系统资源如射频模块
来进行你的应用程序的工作的能量


351
00:22:01,121 --> 00:22:05,359
它也与早期的讲座中
硬件的固定成本相対映


352
00:22:07,728 --> 00:22:08,562
对于蓝条


353
00:22:08,929 --> 00:22:14,401
它表示由你的应用程序引入
用来服务工作负荷的能量


354
00:22:16,436 --> 00:22:19,873
除了瞬间信息
我们还提供平均信息


355
00:22:20,140 --> 00:22:24,912
例如像这个 百分率的平均开销


356
00:22:27,381 --> 00:22:30,017
这个家伙向你展示了平均的能量影响


357
00:22:31,985 --> 00:22:36,356
在底部 你会看到一系列有关图标


358
00:22:36,423 --> 00:22:39,626
CPU、 定位、连网和后台的说明


359
00:22:40,027 --> 00:22:43,096
它还提供一些你如何优化它们的建议


360
00:22:44,431 --> 00:22:45,532
但是请记住


361
00:22:46,166 --> 00:22:48,368
iOS能量计量器的设计是为了


362
00:22:49,169 --> 00:22:53,841
使你迅速高层次地了解代码的能量影响


363
00:22:54,708 --> 00:22:57,644
如果你想要更详细的信息 更加分解


364
00:22:58,212 --> 00:23:00,047
那么请在这个按钮上点击


365
00:23:01,014 --> 00:23:05,752
在你点击这个按钮后
它就会将你弹到对应的工具中


366
00:23:05,953 --> 00:23:10,057
为你的应用程序提供分解的能量信息


367
00:23:11,391 --> 00:23:12,693
这是iOS能量计量器


368
00:23:13,227 --> 00:23:17,164
让我简单地向你介绍工具


369
00:23:18,398 --> 00:23:20,367
工具
你们很多人都使用过它们


370
00:23:20,834 --> 00:23:21,902
它看起来很相似


371
00:23:22,236 --> 00:23:26,139
例如 你看这个在屏幕上的是定位工具


372
00:23:27,040 --> 00:23:27,875
我们如何开始


373
00:23:29,476 --> 00:23:35,382
我们以触发这个按钮来开始
记录它然后停止


374
00:23:37,184 --> 00:23:41,421
在你记录后
你将会看到像这样的系统活动


375
00:23:43,190 --> 00:23:48,629
你就会明白为什么
你看到这样的活动性


376
00:23:48,829 --> 00:23:53,534
例如在这里你会看到定位服务
它正在努力请求定位


377
00:23:54,902 --> 00:23:57,070
如果你想要更多 更详细的信息


378
00:23:58,138 --> 00:24:00,140
到这儿 扩展细节


379
00:24:00,707 --> 00:24:02,576
然后你将使用这个家伙


380
00:24:04,711 --> 00:24:05,812
代码堆栈


381
00:24:07,814 --> 00:24:10,984
这就是对工具的介绍


382
00:24:11,084 --> 00:24:14,087
接下来让我来简单地说下演示程序


383
00:24:16,456 --> 00:24:18,825
屏幕上你将会看到
我们的演示程序的屏幕截图


384
00:24:19,026 --> 00:24:20,194
我们管它叫能量兄弟


385
00:24:21,094 --> 00:24:23,230
因此作为一名iOS能量软件工程师


386
00:24:23,363 --> 00:24:27,801
我迫切地想知道是否
我能够在每个地方提高我的能量效率


387
00:24:28,101 --> 00:24:30,637
不只是我的电话
而且是我的日常生活


388
00:24:31,605 --> 00:24:33,640
能量兄弟可以很好地满足我的需求


389
00:24:33,974 --> 00:24:35,342
例如
我可以用它拍摄一张图片


390
00:24:36,176 --> 00:24:41,982
它会从我拍摄的图片中
提取能量计的信息


391
00:24:42,850 --> 00:24:45,152
它会询问我的设备的定位


392
00:24:46,420 --> 00:24:48,755
根据我的定位获取气象信息


393
00:24:49,489 --> 00:24:53,527
将气象信息与我的使用相关联
显示在屏幕上


394
00:24:55,128 --> 00:24:57,931
结构是这样的
有个集中数据管理器


395
00:24:59,700 --> 00:25:04,505
如果我从那儿导入一张图
它就尝试着对它进行采集


396
00:25:05,572 --> 00:25:06,840
并且基于定位


397
00:25:07,908 --> 00:25:14,047
它会尝试着寻找一个连网服务
来根据我的定位获得天气信息


398
00:25:15,048 --> 00:25:20,020
然后数据管理器会将这个信息关联
作为一个曲线显示在屏幕上


399
00:25:21,588 --> 00:25:25,225
然后我们试着
给它一张图片看一下这个新工具


400
00:25:25,592 --> 00:25:29,696
是如何帮助我们识别和提高
能量兄弟的能量效率的


401
00:25:31,965 --> 00:25:34,768
在左侧的屏幕上
你将会看到Xcode


402
00:25:35,235 --> 00:25:37,905
右侧是我的测试设备的屏幕截图


403
00:25:38,705 --> 00:25:42,910
好 让我们通过打开项目文件
来启动能量兄弟


404
00:25:44,511 --> 00:25:47,247
它目前正在做的是
在我点击了这个圆形按钮后


405
00:25:48,182 --> 00:25:53,120
它就尝试着构建 发送二进制文件


406
00:25:53,287 --> 00:25:54,121
并为我启动它


407
00:25:54,855 --> 00:25:56,823
一旦它被启动，我们就会看到这个


408
00:25:57,424 --> 00:25:58,258
它在这儿


409
00:25:58,759 --> 00:26:01,795
让我们来调试这里的导航器


410
00:26:04,198 --> 00:26:05,332
能量影响就在这儿


411
00:26:05,632 --> 00:26:06,567
我们继续


412
00:26:09,803 --> 00:26:12,005
我们最想做的就是


413
00:26:14,908 --> 00:26:16,977
看看这里是否有活动的方块


414
00:26:17,044 --> 00:26:19,112
因为我并没有在用户界面做任何事情


415
00:26:20,180 --> 00:26:23,116
因此看起来没有什么活动的方块


416
00:26:23,550 --> 00:26:24,384
这是个好的现象


417
00:26:24,618 --> 00:26:28,188
因为在应用程序空闲的时候
是不应该有过多的事情发生


418
00:26:28,522 --> 00:26:29,356
这样很好


419
00:26:29,957 --> 00:26:34,027
让我点击“导入图片”导入一张图片


420
00:26:34,962 --> 00:26:36,897
从我的相册中选择一张图片


421
00:26:38,098 --> 00:26:41,134
它将试着提取信息
而我将设置采集


422
00:26:42,336 --> 00:26:46,540
好了 我看到许多的活动出现了


423
00:26:47,541 --> 00:26:49,877
包括CPU 连网和定位


424
00:26:50,844 --> 00:26:53,347
但是从它们当中我立即注意到一件事


425
00:26:54,047 --> 00:26:56,016
那就是定位一直都在进行中


426
00:26:56,550 --> 00:26:58,085
这可不合情理


427
00:26:58,552 --> 00:27:03,423
因为能量兄弟可不是那种
跟踪你跑步锻炼的应用程序


428
00:27:04,291 --> 00:27:07,561
那么我为什么需要持续
监控我的设备的定位呢


429
00:27:07,861 --> 00:27:08,695
这太不合理了


430
00:27:09,429 --> 00:27:13,166
因此来看看定位工具将会告诉我们什么


431
00:27:13,233 --> 00:27:16,537
以及我们如何来识别代码行
来改进这种情况


432
00:27:17,838 --> 00:27:21,875
接下来我将要点击定位工具


433
00:27:22,643 --> 00:27:24,378
我说是重启


434
00:27:25,345 --> 00:27:30,050
然后你试着用这个工具
为我启动这个应用程序


435
00:27:35,923 --> 00:27:38,692
好了
让我来重新再次导入图片


436
00:27:42,062 --> 00:27:43,197
设置采集


437
00:27:43,830 --> 00:27:44,665
继续


438
00:27:45,832 --> 00:27:48,202
好了
在屏幕上你可以看到这个


439
00:27:49,069 --> 00:27:50,504
这是定位活动率


440
00:27:50,971 --> 00:27:52,906
它不停地在进行 没有停止


441
00:27:54,341 --> 00:27:55,175
但是它在哪儿


442
00:27:55,542 --> 00:27:56,777
我们在哪儿导入的


443
00:27:57,678 --> 00:27:59,246
看这个


444
00:28:00,380 --> 00:28:01,815
进入到扩展细节


445
00:28:04,451 --> 00:28:09,756
就是这部分
请求定位


446
00:28:10,123 --> 00:28:12,025
那是我们如何请求定位服务


447
00:28:13,927 --> 00:28:15,195
让我们停在这儿


448
00:28:17,431 --> 00:28:19,399
回到Xcode


449
00:28:21,502 --> 00:28:25,572
查找请求定位


450
00:28:26,473 --> 00:28:27,941
好了
它已经在这儿了


451
00:28:29,877 --> 00:28:31,478
那么请求想要做什么呢


452
00:28:32,880 --> 00:28:36,049
首先你想要设置确定视图控制器


453
00:28:40,487 --> 00:28:44,525
在这一片代码中
你想要建立创建一个定位管理器


454
00:28:45,359 --> 00:28:48,228
然后你就要调用起始更新定位


455
00:28:48,996 --> 00:28:50,297
在这一行之后


456
00:28:50,631 --> 00:28:56,703
所发生的是定位服务通过那的一个回调


457
00:28:57,004 --> 00:28:59,606
来周期性地向我们推送位置更新


458
00:29:02,743 --> 00:29:04,845
那么在回调中
让我们看看它做了些什么


459
00:29:05,846 --> 00:29:10,584
首要的事情是你想要看
这里是否有更新的任何东西


460
00:29:11,018 --> 00:29:14,087
如果它是零那是无效的
我们忽视它 返回


461
00:29:15,355 --> 00:29:16,623
然后我们将它保存


462
00:29:17,024 --> 00:29:22,763
我们说“是否定位是水平精度是实际
符合我们的标准和期望”


463
00:29:22,930 --> 00:29:24,264
如果没有
我们返回


464
00:29:25,399 --> 00:29:26,233
如果有


465
00:29:26,300 --> 00:29:30,037
那么我们会试着处理
确定视图控制器内部的定位


466
00:29:30,737 --> 00:29:31,839
然后返回


467
00:29:32,706 --> 00:29:36,143
不断地重复这种回调路径


468
00:29:36,510 --> 00:29:39,546
每当我们从定位服务中
接收到一个回调就这样


469
00:29:40,247 --> 00:29:41,248
推送看起来并不好


470
00:29:41,748 --> 00:29:42,850
那么我们应该怎么做呢？


471
00:29:43,183 --> 00:29:47,588
我们应该做的就是当我们获得了
一个数值时就停止它


472
00:29:50,691 --> 00:29:52,259
就像这一行


473
00:29:53,460 --> 00:29:58,599
我们说当我们获得了一个定位数值更新
我们就将它停止


474
00:30:00,234 --> 00:30:02,970
让我们来看看
再次启动


475
00:30:03,303 --> 00:30:05,205
看看能量计量器将会告诉我们什么


476
00:30:05,672 --> 00:30:11,111
我希望看到的是在我首次接收到
一个成功的定位更新后


477
00:30:11,178 --> 00:30:14,915
我应该将定位停止
并且定位服务不应该永远在进行


478
00:30:16,817 --> 00:30:18,519
让我们等待将它启动


479
00:30:24,625 --> 00:30:25,459
嗯


480
00:30:27,194 --> 00:30:30,063
好 进入到iOS能量计量器


481
00:30:32,432 --> 00:30:34,201
让我再次试着导入一张图片


482
00:30:35,736 --> 00:30:37,738
从图库中选择一张图片


483
00:30:38,205 --> 00:30:39,139
设置采集


484
00:30:40,841 --> 00:30:45,212
好了 定位
一秒 两秒 三秒 四秒 它不见了


485
00:30:46,547 --> 00:30:49,950
只是一行代码就起到了立竿见影的效果


486
00:30:50,984 --> 00:30:52,986
你可以仔细思考下这个场景


487
00:30:53,287 --> 00:30:56,056
所以如果这个应用程序
已经打开了很长时间


488
00:30:56,823 --> 00:31:00,160
想象一下通过修改一行代码
你可以节约多少能量


489
00:31:00,794 --> 00:31:01,695
真是令人惊叹


490
00:31:02,763 --> 00:31:05,999
让我们多尝试几次能量兄弟


491
00:31:06,066 --> 00:31:09,236
看看当我们导入另一个
下次会发生什么


492
00:31:10,671 --> 00:31:12,806
好了 我们导入了另一个


493
00:31:14,241 --> 00:31:17,477
我看到定位出现了四秒


494
00:31:18,245 --> 00:31:19,112
但是这次


495
00:31:20,113 --> 00:31:23,483
我注意的大事件是连网服务


496
00:31:24,718 --> 00:31:25,752
这看起来不太好


497
00:31:26,186 --> 00:31:31,191
能量兄弟想要发现连网服务的原因是
它想要获得天气信息


498
00:31:31,692 --> 00:31:34,962
但是我两分钟之前刚查询过


499
00:31:35,762 --> 00:31:41,935
所以天气不会在两分钟内
甚至是一个小时内有很大变化


500
00:31:42,002 --> 00:31:44,204
我可以说天气也不会有多大变化


501
00:31:44,738 --> 00:31:47,341
我们想重新连网的目的是什么


502
00:31:47,674 --> 00:31:50,911
尽管我们早在两分钟之前已经有过请求


503
00:31:52,045 --> 00:31:55,115
因此让我们直接到代码
看看我们如何来修复这个问题


504
00:31:56,783 --> 00:32:02,256
我们实际上请求定位的地方
就在天气文件的内部


505
00:32:02,789 --> 00:32:05,926
有个函数叫做获取如果失踪


506
00:32:06,326 --> 00:32:09,830
让我们来看看它在第一部分做些什么


507
00:32:09,897 --> 00:32:11,298
我们尝试着设置一些参数


508
00:32:11,365 --> 00:32:13,500
如日期 基于查询的URL


509
00:32:13,800 --> 00:32:18,438
基于设备定位的URL以及当前日期


510
00:32:19,339 --> 00:32:22,242
以及我是否在今天之内进行过这种查询


511
00:32:23,110 --> 00:32:26,780
你将为定位坐标保留原点坐标


512
00:32:26,847 --> 00:32:32,452
你将要设置一个完全是
一个小时的秒的数目的常数


513
00:32:33,353 --> 00:32:35,522
所以我们应该首先尝试去做的是


514
00:32:35,956 --> 00:32:37,791
如果我们今天已经查询过了


515
00:32:38,859 --> 00:32:42,396
并且从两分钟前
我们最后一次查询起


516
00:32:42,663 --> 00:32:44,932
数据管理器已经提取了天气


517
00:32:45,499 --> 00:32:46,667
那么我们说我们就返回


518
00:32:49,102 --> 00:32:52,039
下来是如果我们今天没有做


519
00:32:53,040 --> 00:32:55,742
并且数据管理器已经提取了天气


520
00:32:55,976 --> 00:32:56,810
那我们还是返回


521
00:32:58,445 --> 00:33:02,549
如果这两种情况都不满足


522
00:33:03,050 --> 00:33:05,352
那么我们就尝试着建立一个


523
00:33:07,154 --> 00:33:11,124
基于定位 日期的任务
我们将在这里下载它


524
00:33:12,993 --> 00:33:14,161
那有什么错么


525
00:33:15,128 --> 00:33:18,665
它出错的原因实际上在这儿


526
00:33:20,234 --> 00:33:21,068
计量器内部


527
00:33:21,902 --> 00:33:27,140
因此我们将添加像这样的另外一种情况


528
00:33:27,841 --> 00:33:29,877
就是说如果我今天已经完成的了这个


529
00:33:29,943 --> 00:33:33,313
并且先前的提取在一个小时之内


530
00:33:33,580 --> 00:33:34,781
那我就不再做它


531
00:33:36,149 --> 00:33:38,318
让我们来再次启动它


532
00:33:38,585 --> 00:33:42,856
来看看如何在能量计量器的内部
看到改进的地方


533
00:33:43,390 --> 00:33:44,958
我们希望看到是这样的


534
00:33:45,292 --> 00:33:48,328
因为我们在如五分钟之前就完成了提取


535
00:33:49,429 --> 00:33:52,366
当我们在下个小时内
再次导入一张照片的时候


536
00:33:52,432 --> 00:33:54,635
就不应该每次都看到任何的连网


537
00:33:55,135 --> 00:33:58,105
让我们来看看能量计量器
是否同意我的理论


538
00:34:01,341 --> 00:34:02,176
好


539
00:34:03,644 --> 00:34:04,478
开始


540
00:34:07,114 --> 00:34:08,748
我尝试导入一张图片


541
00:34:10,016 --> 00:34:12,853
从相册中选一张图片
设置采集


542
00:34:18,391 --> 00:34:19,493
我看到了定位


543
00:34:19,860 --> 00:34:21,360
它像以前呆了四秒钟


544
00:34:22,161 --> 00:34:24,364
但是神奇的是
所有的连网都不见了


545
00:34:24,531 --> 00:34:27,333
这正是我们所希望的


546
00:34:27,935 --> 00:34:32,172
所以这是提高我们的能量兄弟的
能量效率的又一种好办法


547
00:34:33,674 --> 00:34:35,108
除了前台


548
00:34:35,708 --> 00:34:40,047
能量兄弟还可以在后台
消耗大量的电池


549
00:34:40,480 --> 00:34:47,054
让我们看看当能量兄弟实际上在后台时
能量计量器能告诉我们什么


550
00:34:47,821 --> 00:34:51,091
我们通过点击返回主页按钮
将能量兄弟放入后台


551
00:34:55,128 --> 00:34:59,499
我们看到的是这儿


552
00:35:02,436 --> 00:35:07,307
我们看到许多能量兄弟的后台活动


553
00:35:08,976 --> 00:35:15,449
那就意味着只要能量兄弟在后台


554
00:35:15,516 --> 00:35:17,251
设备就不能休眠


555
00:35:17,684 --> 00:35:21,421
这样就会消耗大量的能量
因为保持设备唤醒状态要有固定成本


556
00:35:22,723 --> 00:35:26,727
这并不合理
因为能量兄弟不需要在后台做任何事情


557
00:35:27,728 --> 00:35:29,129
这里出什么错了吗？


558
00:35:31,832 --> 00:35:37,538
当我们真的要转到后台的时候
让我们进入到回调


559
00:35:39,139 --> 00:35:39,973
这就是代码


560
00:35:41,408 --> 00:35:42,242
它做些什么


561
00:35:43,110 --> 00:35:46,480
它做以下事情
你在设法设置后台任务标示符


562
00:35:47,748 --> 00:35:50,617
它们所做的就是为数据管理器存档


563
00:35:50,817 --> 00:35:53,620
就是将所有更改都存入数据管理器中


564
00:35:54,254 --> 00:35:56,056
它们会说等待输入


565
00:35:56,356 --> 00:35:59,092
如果真的要完成它
我们就会在后台任务中编写代码


566
00:36:01,094 --> 00:36:01,962
听起来合理吗？


567
00:36:02,462 --> 00:36:03,997
不合理
为什么不合理？


568
00:36:04,765 --> 00:36:07,367
因为我们的应用程序一直会在后台
对不对？


569
00:36:07,601 --> 00:36:11,805
那么用户如何能够真的通过
用户界面与能量兄弟来进行互动呢


570
00:36:12,573 --> 00:36:14,107
所以根本就没有输入


571
00:36:14,441 --> 00:36:15,642
而我们一直在等


572
00:36:16,810 --> 00:36:17,878
这看起来可不太好


573
00:36:18,545 --> 00:36:21,882
我们应该做的就是我们不应该等


574
00:36:27,554 --> 00:36:28,488
相反的


575
00:36:30,524 --> 00:36:31,558
我们应该做这样的事情


576
00:36:32,292 --> 00:36:34,661
在我们将数据存档到数据管理器后


577
00:36:35,495 --> 00:36:40,300
我们将立即调用后台任务
使后台任务标示符无效


578
00:36:41,802 --> 00:36:48,041
让我们再次启动能量兄弟
来看看能量计量器会告诉我们什么


579
00:36:49,042 --> 00:36:50,210
我们希望的是这样


580
00:36:50,744 --> 00:36:54,648
在我们进行数据管理器中的所有更改后


581
00:36:54,882 --> 00:36:58,986
它就会直接退出它本身
释放控制给助手


582
00:36:59,119 --> 00:37:01,255
它将不会像以前那样一直呆在后台中


583
00:37:07,895 --> 00:37:10,964
好了 进入能量计量器


584
00:37:13,267 --> 00:37:14,935
将能量兄弟放入后台中


585
00:37:16,036 --> 00:37:19,273
我们现在在后台
一秒 两秒 它消失了


586
00:37:21,308 --> 00:37:22,442
这次我们又赢了


587
00:37:23,143 --> 00:37:28,081
所以要记住
我刚才做的一点点现场修复


588
00:37:28,715 --> 00:37:30,517
你就会看到有显著的改进


589
00:37:30,984 --> 00:37:32,819
下来Abhinav将继续向你们介绍


590
00:37:32,886 --> 00:37:36,323
因为我们持续几个小时
甚至一天都是在讲


591
00:37:36,723 --> 00:37:38,759
进行重大的电池改进的内容


592
00:37:39,459 --> 00:37:42,729
我的演示就到这里
下来还是Abhinav


593
00:37:47,768 --> 00:37:48,869
谢谢 Pai-Han


594
00:37:51,772 --> 00:37:55,375
这是个很不错的演示 回到幻灯片看看
演示都发生了什么并做个总结


595
00:37:55,876 --> 00:38:01,181
我们开始使用能量兄弟
无效率的代码我们像用户那样运行


596
00:38:01,248 --> 00:38:02,349
看看都发生了什么


597
00:38:02,416 --> 00:38:03,650
这所有的都亮了


598
00:38:03,851 --> 00:38:06,720
糟糕 糟糕 真糟糕
能量消耗太大了


599
00:38:07,120 --> 00:38:11,258
你的应用程序在电池用户界面上
能量消耗很高


600
00:38:11,658 --> 00:38:12,793
我们如何修复它？


601
00:38:12,860 --> 00:38:16,763
我们来到定位 我们说
“嗨 定位被启动了 那么停止”


602
00:38:17,197 --> 00:38:19,700
改了一行代码
定位停止了


603
00:38:20,167 --> 00:38:22,236
让我们看看
之前和之后它看起来是什么样子


604
00:38:23,470 --> 00:38:28,909
如果你聚焦定位时间轴
你就会看到定位一直在进行着


605
00:38:29,409 --> 00:38:34,381
后来只是在每当有关一张图片导入
有实际请求的时候定位才进行


606
00:38:35,816 --> 00:38:36,750
让我们继续说连网


607
00:38:36,984 --> 00:38:42,422
之前每张新图片导入
我们就获得天气信息


608
00:38:42,623 --> 00:38:45,392
那可不好
我们想要消减传输


609
00:38:45,459 --> 00:38:46,727
我们放入了一个很简单的块


610
00:38:46,793 --> 00:38:49,930
嗨 如果这是最近调用的 不要管了


611
00:38:49,997 --> 00:38:51,465
我们不再需要新的信息


612
00:38:52,266 --> 00:38:54,701
那对能量计量器有什么影响


613
00:38:55,002 --> 00:38:57,437
还是两张图片
之前和之后


614
00:38:57,738 --> 00:38:59,573
如果你聚焦连网部分


615
00:38:59,873 --> 00:39:01,808
连网在很长时间内都是高亮的


616
00:39:02,176 --> 00:39:06,313
顶部的红条一直在高亮着
说明连网硬件消耗很大


617
00:39:06,747 --> 00:39:09,383
在应用程序使用期间
消耗了很多的能量


618
00:39:09,850 --> 00:39:11,885
在底部
我们只做了一次连网


619
00:39:12,786 --> 00:39:15,522
那之后
最近刚调用过的就不再做了


620
00:39:17,658 --> 00:39:19,960
后台对话怎么样


621
00:39:20,093 --> 00:39:23,530
当我们进入后台的时候
我们将我们的状态存入数据库


622
00:39:23,864 --> 00:39:25,966
然后说“嗨 让我们等待用户输入”


623
00:39:26,333 --> 00:39:29,203
不是等待用户输入的好地方
目前用户可能在输入任何东西


624
00:39:30,003 --> 00:39:31,271
非常简单的修复


625
00:39:31,471 --> 00:39:33,073
我们说不要等待用户输入了


626
00:39:33,373 --> 00:39:34,908
只需要调用任务完成处理器


627
00:39:35,309 --> 00:39:38,712
告诉系统“嗨 我完成了 悬置我吧
让系统休眠吧”


628
00:39:39,513 --> 00:39:42,216
之前和之后能量计量器
看起来是什么样子呢


629
00:39:42,282 --> 00:39:44,051
让我们集中于后台行


630
00:39:44,618 --> 00:39:47,421
顶部的后台一直在运行


631
00:39:47,888 --> 00:39:51,258
在底部
一旦我们完成了数据库的存档


632
00:39:51,525 --> 00:39:54,228
后台的工作就完成了
我们被悬置了


633
00:39:54,995 --> 00:39:55,829
太神奇了


634
00:39:56,697 --> 00:39:59,700
让我们来看看之前和之后的整个的代码


635
00:40:00,300 --> 00:40:02,302
之前
我们看到一切东西都在发亮


636
00:40:02,769 --> 00:40:05,405
如果这发生在你的程序上
这就是个问题


637
00:40:06,073 --> 00:40:12,045
之后我们进行同样的使用
给用户提供同样的效能和体验


638
00:40:12,412 --> 00:40:16,950
但是硬件上的能量负载却非常非常小


639
00:40:18,852 --> 00:40:22,289
正如我们所承诺的
这个幻灯片最重要的是在开始


640
00:40:22,422 --> 00:40:23,957
如果你的应用程序是顶部的情况


641
00:40:24,291 --> 00:40:25,259
请做些更改


642
00:40:25,325 --> 00:40:28,595
你就会看到
你的程序出现在用户界面的底部


643
00:40:28,862 --> 00:40:31,899
我们所做的就是拿了两个
新安装的iPhone 6


644
00:40:32,432 --> 00:40:34,268
在其中的一个安装了无效率的代码


645
00:40:34,601 --> 00:40:37,237
在第二个安装了经过修复的代码


646
00:40:37,771 --> 00:40:41,975
让它们完成完全相同的工作量
同时也在运行着其它的应用程序


647
00:40:42,309 --> 00:40:46,713
对能量兄弟和其它的应用而言
都是相同的负荷量


648
00:40:47,381 --> 00:40:53,487
我们发现
修复代码要少消耗百分之五十的能量


649
00:40:54,188 --> 00:40:55,756
包括显示能量


650
00:40:56,123 --> 00:40:57,991
两个应用程序都是完全相同的


651
00:40:59,259 --> 00:41:02,462
在右顶部你看到电池用户界面
百分之二十八


652
00:41:02,863 --> 00:41:06,033
而优化过的代码下降很多


653
00:41:06,633 --> 00:41:08,402
用户获得了完全相同的东西


654
00:41:10,971 --> 00:41:11,972
对这个讲座做个总结


655
00:41:12,773 --> 00:41:17,711
对于获得完美的用户体验
电池寿命确实很重要


656
00:41:18,278 --> 00:41:20,113
设计应用程序时要记住三点


657
00:41:20,380 --> 00:41:21,582
从来不做 尽量少做


658
00:41:22,382 --> 00:41:23,417
更有效率地做


659
00:41:23,617 --> 00:41:24,484
在良好的时间去做


660
00:41:26,019 --> 00:41:28,322
后台应用考虑得更加周全


661
00:41:29,623 --> 00:41:31,291
请尝试新的调试工具


662
00:41:31,525 --> 00:41:33,627
我们有实验室
我现在就说的更加详细些


663
00:41:34,261 --> 00:41:35,762
离开时拿份我们的能量指南


664
00:41:35,929 --> 00:41:39,299
它包含有我们这次讲座
的所有信息甚至更多


665
00:41:40,300 --> 00:41:41,835
将你们的应用程序带到能量实验室


666
00:41:43,570 --> 00:41:46,540
有关你在何处可找到
能量指南的更多信息


667
00:41:48,275 --> 00:41:49,776
请找这次讲座的技术支持联系


668
00:41:51,411 --> 00:41:53,413
最后与这些讨论的相关讲座


669
00:41:53,614 --> 00:41:57,017
主要是我们说过的一些概念
但是更加的详细


670
00:41:58,752 --> 00:41:59,887
谢谢大家来参加讲座

